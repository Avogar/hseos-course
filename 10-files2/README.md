
# Файлы и каталоги

## Функции stat, fstat и lstat

```c
#include <sys/stat.h>
int stat(const char *restrict pathname, struct stat *restrict buf);
int fstat(int filedes, struct stat *buf);
int lstat(const char *restrict pathname, struct stat restrict buf);
```
Функция stat возвращает структуру с информацией о файле, указанном в аргументе pathname. Функция fstat возвращает информацию об открытом файле, который определяется дескриптором filedes. 
Функция lstat похожа на функцию stat, но когда ей передается имя символической ссылки, она возвращает сведения о самой символической ссылке, а не о файле, на который она ссылается.
Второй аргумент, buf, является указателем на структуру, которую функция будет заполнять информацией. Определение структуры может отличаться для разных реализаций, но основная ее часть выглядит следующим образом:

```c
struct stat {
	mode_t st_mode; /* тип файла и режим (права доступа) */
	ino_t st_ino; /* номер индексного узла */
	dev_t st_dev; /* номер устройства (файловой системы) */
	dev_t st_rdev; /* номер устройства для специальных файлов */
	nlink_t st_nlink; /* количество ссылок */
	uid_t st_uid; /* идентификатор пользователя владельца */
	gid_t st_gid; /* идентификатор группы владельца */
	off_t st_size; /* размер в байтах, для обычных файлов */
	time_t st_atime; /* время последнего обращения к файлу */
	time_t st_mtime; /* время последнего изменения файла */
	time_t st_ctime; /* время последнего изменения флагов состояния файла */
	blksize_t st_blksize; /* оптимальный размер блока ввода вывода */
	blkcnt_t st_blocks; /* количество занятых дисковых блоков */
};
```
## Типы файлов

1. Обычный файл – наиболее распространенный тип файлов, который хранит данные в том или ином виде. Ядро UNIX не делает различий между
текстовыми и двоичными файлами. Любая интерпретация содержимого файла полностью возлагается на прикладную программу, обрабатываю 
щую файл.
2. Файл каталога. Файлы этого типа содержат имена других файлов и ссылки на информацию о них. Любой процесс, обладающий правом на чтение
каталога, может проверить его содержимое, но только ядро обладает правом на запись в файл каталога. Чтобы внести изменения в каталог, про 
цессы должны пользоваться функциями, обсуждаемыми в данной главе.
3. Специальный файл блочного устройства. Этот тип файлов обеспечивает буферизованный ввод вывод для таких устройств, как дисковые устрой 
ства с фиксированным размером блока.
4. Специальный файл символьного устройства. Этот тип файлов обеспечивает небуферизованный ввод вывод для устройств с переменным размером
блока. Все устройства в системе являются либо специальными файлами блочных устройств, либо специальными файлами символьных устройств.
5. FIFO, или именованный канал. Этот тип файлов используется для организации обмена информацией между процессами. 
6. Сокет. Этот тип файлов используется для организации обмена информацией между процессами через сетевые соединения. Сокеты можно применять и для обмена информацией между процессами на одной и той же ма 
шине. 
7. Символическая ссылка. Файлы этого типа представляют собой ссылки на другие файлы.

Тип файла хранится в поле st_modeструктуры stat. Определить тип файла можно с помощью макроопределений, приведенных ниже 
(Макросы для определения типа файла из  ```c <sys/stat.h> ```)

S_ISREG() Обычный файл
S_ISDIR() Каталог
S_ISCHR() Специальный файл символьного устройства
S_ISBLK() Специальный файл блочного устройства
S_ISFIFO() Канал (именованный или неименованный)
S_ISLNK() Символическая ссылка
S_ISSOCK Сокет

